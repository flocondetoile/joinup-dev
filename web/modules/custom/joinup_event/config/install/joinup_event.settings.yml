# The array of allowed conditions for the event workflow transitions.
# Format of array:
# @code
# [
#   <workflow id> => [
#    <transition key> => [
#       <source state> => [
#         <role1>
#         <role2>
#         .
#         .
#       ]
#     ]
#   ]
# ]
# @endcode
#
# The array is a three dimensions array. The first level is the
# transition key. Each target state is an array of allowed source
# states which in every check, is the current state of the entity.
# Finally, the source states are arrays of roles that are allowed to
# perform this action.
#
# The reverse indexing here (source states
# keyed by the target state) is to follow the state_machines module logic
# of indexing states.
transitions:
  node:event:pre_moderated:
    save_as_draft:
      __new__:
        - authenticated
        - rdf_entity-collection-member
        - rdf_entity-collection-facilitator
        - rdf_entity-solution-facilitator
        - moderator
      draft:
        - owner
    return_to_draft:
      proposed:
        - owner
      validated:
        - owner
    request_changes:
      validated:
        - rdf_entity-collection-facilitator
        - rdf_entity-solution-facilitator
        - moderator
    reject_changes:
      proposed:
        - rdf_entity-collection-facilitator
        - rdf_entity-solution-facilitator
        - moderator
    propose:
      __new__:
        - authenticated
        - rdf_entity-collection-member
      draft:
        - owner
      propose:
        - owner
      validated:
        - owner
    validate:
      __new__:
        - rdf_entity-collection-facilitator
        - rdf_entity-solution-facilitator
        - moderator
      draft:
        - rdf_entity-collection-facilitator
        - rdf_entity-solution-facilitator
        - moderator
    update_published:
      validated:
        - moderator
    request_deletion:
      draft:
        - owner
      validated:
        - owner
    reject_deletion:
      deletion_request:
        - rdf_entity-collection-facilitator
        - rdf_entity-solution-facilitator
        - moderator
    update_proposed:
      proposed:
        - owner
    approve_proposed:
      proposed:
        - rdf_entity-collection-facilitator
        - rdf_entity-solution-facilitator
        - moderator
  node:event:post_moderated:
    save_as_draft:
      __new__:
        - authenticated
        - rdf_entity-collection-member
        - rdf_entity-collection-facilitator
        - rdf_entity-solution-facilitator
        - moderator
      draft:
        - owner
    validate:
      __new__:
        - authenticated
        - rdf_entity-collection-member
        - rdf_entity-collection-facilitator
        - rdf_entity-solution-facilitator
        - moderator
      draft:
        - owner
    update_published:
      validated:
        - owner
        - moderator
    request_changes:
      validated:
        - rdf_entity-collection-facilitator
        - rdf_entity-solution-facilitator
        - moderator
    update_proposed:
      proposed:
        - owner
        - moderator
    approve_proposed:
      proposed:
        - rdf_entity-collection-facilitator
        - rdf_entity-solution-facilitator
        - moderator

# @todo: Build the deletion array.
